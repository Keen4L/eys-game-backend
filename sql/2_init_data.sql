-- ==========================================
-- 鹅鸭杀辅助工具数据初始化 (2_init_data.sql)
-- ==========================================

USE `eys_game`;

-- 清空旧数据
SET FOREIGN_KEY_CHECKS = 0;
TRUNCATE TABLE `sys_user`;
TRUNCATE TABLE `sys_user_stats`;
TRUNCATE TABLE `cfg_role`;
TRUNCATE TABLE `cfg_skill`;
SET FOREIGN_KEY_CHECKS = 1;

-- ==========================================
-- 1. 系统基础数据
-- ==========================================

-- 1.1 默认管理员账号 (密码: admin123)
INSERT INTO `sys_user` (`id`, `username`, `password`, `nickname`, `role_type`, `is_enabled`) 
VALUES (1, 'admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iAt4vVQO', '超级管理员', 2, 1)
ON DUPLICATE KEY UPDATE `nickname` = VALUES(`nickname`);

-- 1.2 初始化管理员战绩
INSERT INTO `sys_user_stats` (`user_id`, `total_matches`, `total_wins`, `goose_wins`, `duck_wins`, `neutral_wins`)
VALUES (1, 0, 0, 0, 0, 0)
ON DUPLICATE KEY UPDATE `user_id` = VALUES(`user_id`);


-- ==========================================
-- 2. 角色定义 (cfg_role)
-- ==========================================
-- 阵营: 0-鹅(好人), 1-鸭(坏人), 2-中立

INSERT INTO `cfg_role` (`id`, `name`, `camp_type`, `description`) VALUES
(1, '网红鹅', 0, '被刀后会同归于尽（所有好人收到警报）。'),
(2, '正义鹅', 0, '全局只有一刀，杀好人自己死。'),
(3, '先知鹅', 0, '可查身份，每次消耗金币。'),
(4, '警长鹅', 0, '每晚一刀，刀好人自己死。'),
(5, '保镖鹅', 0, '每晚可保护一人。'),
(6, '加拿大鹅', 0, '被刀后即刻报警。'),
(7, '医生鹅', 0, '有解药和毒药。'),
(8, '殡仪鹅', 0, '可验尸查看角色。'),
(9, '大白鹅', 0, '每晚查验是否是鸭子。'),
(10, '菲律宾鹅', 0, '刺鸭对方死，刺好人自己死，限一次。'),
(11, '恋爱脑鹅', 0, '连接两人，同生共死。'),
(12, '魔术鹅', 0, '置换两人生命状态。'),
(13, '决斗鹅', 0, '发起决斗，胜者生败者死。'),
(14, '等式鹅', 0, '查验两人是否同一阵营。'),
(15, '猎鹰', 2, '每夜一刀，最后幸存获胜。'),
(16, '呆呆鸟', 2, '被投出局获胜。'),
(17, '鹦鹉', 2, '复制他人技能。'),
(18, '鹈鹕', 2, '吞噬玩家，肚子里的人最后死。'),
(19, '鸭王', 1, '每晚一刀，死亡带走一人。'),
(20, '美女鸭', 1, '连接一人，自己死对方死。'),
(21, '忍者鸭', 1, '连接一人，自己被投对方死。'),
(22, '禁言鸭', 1, '每晚禁言一人，可囤积。'),
(23, '刺客鸭', 1, '每晚猜身份刺杀。'),
(24, '炸弹鸭', 1, '传递炸弹。'),
(25, '梦魇鸭', 1, '每晚梦话一人（封刀封技能）。'),
(26, '火种鸭', 1, '每晚一刀，剩自己时双倍。');


-- ==========================================
-- 3. 技能定义 (cfg_skill) - 重构版
-- ==========================================

INSERT INTO `cfg_skill` (
  `role_id`, `name`, `trigger_phases`, `interaction_type`, `target_count`,
  `max_usage_total`, `max_usage_round`, `target_alive_state`, `exclude_self`,
  `behavior_type`, `tag_expiry_rule`, `tag_restriction`, `query_field`, `description`
) VALUES

-- ============ 鹅阵营 (0-好人) ============

-- 1. 网红鹅 (被动技能，DM控制)
(1, '网红警报', '', 0, 0, 1, 0, 0, 0, 'LOG', NULL, NULL, NULL, '被刀后同归于尽，DM触发'),

-- 2. 正义鹅 (全局一刀)
(2, '正义处决', 'PRE_VOTE', 1, 1, 1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '全局限一刀，杀错自己死'),

-- 3. 先知鹅 (查验身份)
(3, '查验身份', 'PRE_VOTE', 1, 1, 3, 1, 1, 1, 'QUERY', NULL, NULL, 'ROLE_ID', '查看目标角色，限3次'),
(3, '询问鸭数', 'PRE_VOTE', 0, 0, 1, 1, 0, 0, 'QUERY', NULL, NULL, 'DUCK_COUNT', '询问场上鸭子数量'),

-- 4. 警长鹅 (每晚一刀 + 禁闭)
(4, '处决', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀，杀错自己死'),
(4, '禁闭', 'PRE_VOTE', 1, 1, 1, 1, 1, 1, 'TAG', 'NEXT_ROUND', 'BLOCK_SKILL', NULL, '全局一次禁闭'),

-- 5. 保镖鹅 (保护)
(5, '贴身保护', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'TAG', 'NEXT_ROUND', 'NONE', NULL, '每晚保护一人，不能连续两晚保护同一人'),

-- 6. 加拿大鹅 (被动技能，DM控制)
(6, '加拿大警报', '', 0, 0, 1, 0, 0, 0, 'LOG', NULL, NULL, NULL, '被刀后即刻报警，本回合鸭子不可发动技能'),

-- 7. 医生鹅 (毒药/解药二选一)
(7, '注射毒药', 'PRE_VOTE', 1, 1, 1, 1, 1, 1, 'TAG', 'NEXT_ROUND', 'NONE', NULL, '目标延迟死亡'),
(7, '注射解药', 'PRE_VOTE', 1, 1, 1, 1, 1, 1, 'TAG', 'NEXT_ROUND', 'NONE', NULL, '解除目标毒性'),

-- 8. 殡仪鹅 (验尸)
(8, '验尸', 'PRE_VOTE', 1, 1, 1, 1, 2, 1, 'QUERY', NULL, NULL, 'ROLE_ID', '全局一次验尸，查看死者角色'),

-- 9. 大白鹅 (查验鸭子)
(9, '查验鸭子', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'QUERY', NULL, NULL, 'IS_DUCK', '每晚查验左一或右一是否是鸭'),

-- 10. 菲律宾鹅 (刺鸭)
(10, '复仇刺杀', 'PRE_VOTE', 1, 1, 1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '刺鸭对方死，刺错自己死'),

-- 11. 恋爱脑鹅 (连接)
(11, '绑定恋人', 'PRE_VOTE', 1, 2, -1, 1, 1, 1, 'TAG', 'PERMANENT', 'NONE', NULL, '连接两人，不能连续两天连同一人'),

-- 12. 魔术鹅 (生命置换，DM控制)
(12, '生命置换', 'PRE_VOTE', 1, 2, 1, 1, 0, 0, 'LOG', NULL, NULL, NULL, '置换两人生命状态，全局限一次'),

-- 13. 决斗鹅 (被动技能，DM控制)
(13, '发起决斗', '', 0, 0, 1, 0, 0, 0, 'LOG', NULL, NULL, NULL, '被杀后可与对方决斗'),

-- 14. 等式鹅 (查验阵营)
(14, '等式查验', 'PRE_VOTE', 1, 2, -1, 1, 1, 1, 'QUERY', NULL, NULL, 'CAMP_TYPE', '活过第二天后可查两人是否同阵营'),

-- ============ 中立阵营 (2-中立) ============

-- 15. 猎鹰 (每夜一刀)
(15, '猎杀', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每夜一刀，剩鹅时猎杀时刻'),

-- 16. 呆呆鸟 (被动技能，被投出局独赢)
(16, '呆呆被投', '', 0, 0, 0, 0, 0, 0, 'LOG', NULL, NULL, NULL, '被投票出局游戏结束'),

-- 17. 鹦鹉 (复制技能，DM控制)
(17, '复制技能', 'PRE_VOTE', 1, 1, 1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '开局复制一个人的技能'),

-- 18. 鹈鹕 (吞噬)
(18, '吞噬', 'PRE_VOTE', 1, 2, -1, 1, 1, 1, 'TAG', 'PELICAN', 'BLOCK_SKILL', NULL, '每晚最多吞两人，累计吞四人胜利'),

-- ============ 鸭阵营 (1-坏人) ============

-- 19. 鸭王 (每晚一刀 + 被动带走)
(19, '刺杀', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀'),
(19, '临终带走', '', 0, 0, 1, 0, 0, 0, 'LOG', NULL, NULL, NULL, '死亡时带走一人，被刀被毒不可发动'),

-- 20. 美女鸭 (每晚一刀 + 连接)
(20, '刺杀', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀'),
(20, '魅惑连接', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'TAG', 'PERMANENT', 'NONE', NULL, '连一人，对方死自己没事，自己死对方死'),

-- 21. 忍者鸭 (每晚一刀 + 连接)
(21, '刺杀', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀'),
(21, '隐忍标记', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'TAG', 'PERMANENT', 'NONE', NULL, '连一人，被投出去连接的人一起死'),

-- 22. 禁言鸭 (每晚一刀 + 禁言)
(22, '刺杀', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀'),
(22, '禁言', 'PRE_VOTE', 1, 1, 3, 1, 1, 1, 'TAG', 'NEXT_ROUND', 'NONE', NULL, '每晚禁言一人，最多屯三天'),

-- 23. 刺客鸭 (每晚一刀 + 猜身份刺杀)
(23, '刺杀', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀'),
(23, '狙击', 'PRE_VOTE', 2, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '猜身份刺杀，猜对对方死，错自己死'),

-- 24. 炸弹鸭 (自爆，DM控制)
(24, '自爆', '', 0, 0, 1, 0, 0, 0, 'LOG', NULL, NULL, NULL, '夜间自爆'),

-- 25. 梦魇鸭 (每晚一刀 + 梦话)
(25, '刺杀', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀'),
(25, '梦魇缠绕', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'TAG', 'NEXT_ROUND', 'BLOCK_SKILL', NULL, '封刀封技能，不能连续两天梦一人'),

-- 26. 火种鸭 (每晚一刀/双刀)
(26, '灭口', 'PRE_VOTE', 1, 1, -1, 1, 1, 1, 'LOG', NULL, NULL, NULL, '每晚一刀，剩自己时双刀');


-- ==========================================
-- 数据验证
-- ==========================================
SELECT (SELECT COUNT(*) FROM cfg_role) AS '角色总数', (SELECT COUNT(*) FROM cfg_skill) AS '技能总数';
